<!-- https://github.com/nolandcraftworks/jollo-radio-es -->


<!doctype html><html><head> <meta charset="utf-8" /><link rel="icon" href="https://f001.backblazeb2.com/file/nolandcraftworks/jolloradioes.ico?v=1"><style>body,html{height:100%}body{background:#000;overflow:hidden;color:#00ff72;margin:0}::-moz-selection{color:#000;background:#0f7}::selection{color:#000;background:#0f7}*{outline:0!important;box-sizing:border-box}span{display:block}#parent{display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr);grid-column-gap:0;grid-row-gap:0;height:100%}#playlist{grid-area:1/1/2/2;max-height:50vh;overflow-Y:scroll;overflow-X:hidden}#player{grid-area:2/1/3/2;border-top:1px solid #00ff72}#room{grid-area:1/2/2/3;border-left:1px solid #00ff72;max-height:50vh;overflow-Y:scroll;overflow-X:hidden}#chat{grid-area:2/2/3/3;border-top:1px solid #00ff72;border-left:1px solid #00ff72;cursor:text}#playlist,#room,textarea{overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}#room::-webkit-scrollbar{width:0;height:0}#playlist::-webkit-scrollbar{width:0;height:0}textarea{width:100%;height:100%;background:0 0;border:none;color:#00ff72;resize:none;padding:0;margin:0}textarea::-webkit-scrollbar{width:0;height:0}*{font-family:Consolas,monospace!important;font-size:14px;text-rendering:geometricPrecision}#parent>div{padding:3px 5px}::placeholder{color:#009844;opacity:1}.trackspan{text-decoration:none}.trackspan.active::before{content:'>>';white-space:pre;background:#0f7;color:#000}.disabled{pointer-events:none}.undone{pointer-events:none}</style></head><body><div id="parent"> <div id="player"></div><div id="playlist"></div><div id="room"></div><div id="chat"> <textarea class="disabled undone" id="input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="8" placeholder="connecting"/></textarea> </div></div><script>let connectingtimer=null;function connectingcheck(){let e=this.count||0;++e>3&&(e=0),this.count=e,input.setAttribute("placeholder",`connecting${".".repeat(e)}`)}function nickfollowup(){localStorage.getItem("nick")?(input.setAttribute("maxlength","1000"),input.setAttribute("placeholder",""),sendmessage(localStorage.getItem("nick"))):input.setAttribute("placeholder","please type a username then hit enter")}connectingtimer=setInterval(connectingcheck,360);let audioplayer=null;var input=document.getElementById("input");let room=document.getElementById("room"),playlist=document.getElementById("playlist"),player=document.getElementById("player");player.insertAdjacentHTML("afterbegin",`\n  <span><span style="display:inline" id="audiostatus">xx</span> <span style="display:inline" id="playerposition">wait</span> | \n  ${window.location.protocol}//${window.location.host}/radio</span>\n  <span id="playerstatus"></span>\n  <span id="buffering"></span>\n`),input.addEventListener("keypress",function(e){if(13===e.keyCode)if(e.preventDefault(),localStorage.getItem("nick")){if(0===input.value.length)return;send()}else{input.setAttribute("placeholder","");let e=input.value.replace(/[^a-zA-Z0-9]/g,"").toLowerCase().substring(0,8);if(0===e.length)return;input.value=e,localStorage.setItem("nick",e),send(),input.value="",input.setAttribute("maxlength","1000")}}),input.addEventListener("input",function(){let e=input.value.replace(/(?:\r\n|\r|\n)/g," ");input.value=e});let ws,trybadcomm,reconnectbadcomm,finishedloadinghistory=!1,handler={promptpassword:()=>{console.log("prompt password"),input.setAttribute("placeholder","enter password"),localStorage.getItem("password")&&sendmessage(localStorage.getItem("password"))},unlocked:e=>{localStorage.setItem("password",e),input.setAttribute("placeholder","")},status:e=>{let{maxresources:t,queuesize:n,processingsize:o}=e;document.getElementById("playerstatus").innerHTML=`&gt;&gt; m${t}, q${n}, p${o}`},position:e=>{let t=document.getElementById("playerposition");t.innerHTML=null===e?"ready":void 0===e?"ready":"live";let n=document.querySelector(".trackspan.active");n&&n.classList.remove("active"),(n=document.querySelector(`.trackspan[data-uuid="${e}"]`))&&n.classList.add("active")},messagehistory:e=>{finishedloadinghistory=!1;for(let t=0;t<e.length;t++)handler.message(e[t]);finishedloadinghistory=!0},message:e=>{let{nick:t,chat:n}=e,o=room.scrollTop===room.scrollHeight-room.offsetHeight;room.insertAdjacentHTML("beforeend",`<span>&lt;${t}&gt; ${n}</span>`),finishedloadinghistory||(room.scrollTop=1e11),finishedloadinghistory&&o&&(room.scrollTop=1e11)},songhistory:e=>{for(let t=0;t<e.length;t++)handler.song(e[t]);playlist.scrollTop=0},song:e=>{try{let{url:t,uuid:n,status:o,nick:i}=e,a=Number(n.split("-")[0]);if((+new Date-a)/1e3>43200)return;playlist.insertAdjacentHTML("afterbegin",`<span class="trackspan" data-uuid="${n}" data-status="${o}">&lt;${i}&gt;&nbsp;${t}</span>`)}catch(e){}}},audiostarted=!1,host=window.location.hostname;function startwebsocket(){playlist.innerHTML="",room.innerHTML="",(ws=new WebSocket(`ws://${host}:9302`)).onmessage=(e=>{let t=JSON.parse(e.data);t&&t.type&&handler[t.type]&&handler[t.type](t.data)}),ws.onopen=(()=>{clearInterval(connectingtimer),input.classList.remove("disabled"),audiostarted?nickfollowup():input.setAttribute("placeholder","double click here to start audio")}),trybadcomm=null,trybadcomm=setInterval(function(){1!==ws.readyState&&(ws.close(),reconnectbadcomm())},4e3),reconnectbadcomm=null,reconnectbadcomm=function(){clearInterval(trybadcomm),input.setAttribute("placeholder","reconnecting..."),setTimeout(function(){startwebsocket()},2e3)}}function sendmessage(e){ws.send(JSON.stringify({type:"message",data:e}))}function send(){let e=input.value;input.value="",sendmessage(e)}startwebsocket();let audiostatus=document.getElementById("audiostatus"),buffering=document.getElementById("buffering"),buffertimer=380,buffercheck=function(){let e=this.count||0;++e>3&&(e=0),this.count=e,0===audioplayer.buffered.length?(buffering.innerHTML=`buffering${".".repeat(e)}`,buffertimer=380):(buffering.innerHTML="",buffertimer=2e3),audioplayer.ended?(buffering.innerHTML="audio stream error.. retrying..",setTimeout(()=>{audioplayer.pause(),audioplayer=null,(audioplayer=new Audio(`${window.location.protocol}//${window.location.host}/radio?${+new Date}`)).play(),buffercheck()},3e3)):setTimeout(buffercheck,buffertimer)},clickcount=0;document.addEventListener("click",()=>{if(0===clickcount)return clickcount=1,void input.classList.remove("undone")}),input.addEventListener("click",()=>{audiostarted||1!==clickcount||(audiostarted=!0,audiostatus.innerHTML="&gt;&gt;",(audioplayer=new Audio(`${window.location.protocol}//${window.location.host}/radio?${+new Date}`)).play(),buffercheck(),nickfollowup())}),window.addEventListener("resize",()=>{room.scrollTop=1e11});</script></body></html>
